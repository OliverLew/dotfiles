#!/bin/sh

listfiles () {
    # put -L before path; put -maxdepth before positional args
    find -L "$(dirname "$target")" \
         -maxdepth 1 -type f -print0 \
         -iregex '.*\(jpe?g\|bmp\|png\|gif\)$' \
         | sort -z
}

target="$(realpath "$1")"

# grep -z arg works with sort -z in function listfiles
count="$(listfiles | grep -m 1 -ZznF "$target" | cut -d: -f1)"

if [ -n "$count" ]; then
    #  xargs -0 arg works with find -print0 in function listfiles
    listfiles | xargs -0 sxiv -a -n "$count" --
else
    sxiv -- "$@" # fallback
fi
