#!/bin/sh


tmpfile="/tmp/status/cpu_info"
for col in $(grep "cpu " /proc/stat | tr -d cpu); do
    total=$((total + col))
    count=$((count + 1))
    if [ "$count" -lt 4 ] || [ "$count" -gt 5 ]; then
        active=$((active + col))
    fi
done

if [ -f "$tmpfile" ]; then
    read -r active_old total_old < "$tmpfile"
    active_inc=$((active - active_old))
    total_inc=$((total - total_old))
fi
echo "$active $total" > "$tmpfile"

if [ -n "$total_inc" ] && [ "$total_inc" -gt 10 ]; then
    printf "%2s" $((active_inc * 100 / total_inc))
else
    sleep 1
    $0
fi
