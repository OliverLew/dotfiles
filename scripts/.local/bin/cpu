#!/bin/sh

tmpfile="/tmp/tmux_cpu_info"

show_cpu()
{
    total=0
    active=0
    count=0
    for i in $(grep "cpu " /proc/stat | tr -d cpu); do
        total=$((total + i))
        count=$((count + 1))
        if [ "$count" -lt 4 ] || [ "$count" -gt 5 ]; then
            active=$((active + i))
        fi
    done

    if [ -f "$tmpfile" ]; then
        read -r active_old total_old < "$tmpfile"
        active_inc=$((active - active_old))
        total_inc=$((total - total_old))
    fi
    echo "$active $total" > "$tmpfile"

    if [ -n "$total_inc" ] && [ "$total_inc" -gt 10 ]; then
        printf "%2s" $((active_inc * 100 / total_inc))
    else
        sleep 1
        show_cpu
    fi
}

show_cpu
