#!/bin/sh
#
# file: setmonitor
# link: https://github.com/OliverLew/dotfiles
#
# A script to configure multiple displays with xrandr
#

monitors=$(xrandr | awk '{ if ($2 == "connected") print $1 }')

add_opt() { index=$((index + 1)); options="${options}$index $1\n"; }
add_cmd() { eval "command_$index=\"$*\""; }

# Cancel
add_opt "Cancel"
add_cmd true

# Single Monitor
for m in $monitors; do
    add_opt "Single\t$m"
    cmd="xrandr --output $m --auto --primary"
    for n in $monitors; do
        [ "$n" = "$m" ] && continue
        cmd="$cmd --output $n --off"
    done
    add_cmd "$cmd"
done

# Dual monitor
for m in $monitors; do
    for n in $monitors; do
        [ "$m" = "$n" ] && continue
        add_opt "Dual  \t$m -> $n"
        add_cmd xrandr --output "$m" --auto --primary \
                       --output "$n" --auto --right-of "$m"
        add_opt "Mirror\t$m -> $n"
        add_cmd xrandr --output "$m" --auto --primary \
                       --output "$n" --auto --same-as "$m"
    done
done

choice=$(printf "%s$options" "" \
    | dmenu -i -l 10 -p "Choose a monitor configuration" \
    | cut -d " " -f 1)

eval "\$command_$choice"
