#!/bin/sh

printf "%s %s  %s\n" "ahead" "behind" "repo path"
if [ -f "$HOME/.config/git-autofetch" ]; then
    while read -r p; do
        # stats
        upstream="$(git -C "$p" for-each-ref --format='%(upstream:short)' "$(git -C "$p" symbolic-ref -q HEAD)")"
        local="$(git -C "$p" branch --show-current)"
        left="$(git -C "$p" rev-list --count --left-only "$local"..."$upstream")"
        right="$(git -C "$p" rev-list --count --right-only "$local"..."$upstream")"
        if [ "$left" -gt 0 ]; then
            printf "\e[34m%5s\e[0m" "+$left"
        else
            printf "%5s" "+$left"
        fi
        printf "  "
        if [ "$right" -gt 0 ]; then
            printf "\e[31m%5s\e[0m" "-$right"
        else
            printf "%5s" "-$right"
        fi
        printf "  "
        echo "$p"
    done < "$HOME/.config/git-autofetch"
fi
